# CLAUDE.md - 操作指南

## 测试文件修改原则

**重要规则**：永远不要去修改测试文件，不到迫不得已的时候。如果确实需要修改测试文件，必须先征求用户的同意。这是因为测试文件中可能有严重的错误或特定的期望，修改它们可能会导致测试的有效性问题。

应遵循的方法是：
1. 分析测试文件以理解测试期望的行为
2. 调整业务代码以匹配测试期望，而不是反过来
3. 只有在获得明确授权后才能修改测试文件

## 调试与修复策略

1. **错误分析**：在修改代码前先彻底分析问题根源
   - 确定问题是数据流问题、业务逻辑问题还是显示问题
   - 使用日志记录关键步骤，跟踪数据流向
   - 确认参数传递、类型转换和数据检索过程

2. **分层修复顺序**：
   - 先确保数据结构和类型正确（例如atom vs string键、关联数据加载等）
   - 再修复业务流程和数据转换逻辑
   - 最后处理UI渲染和显示相关逻辑

3. **环境特定处理**：
   - 可以使用`if Mix.env() == :test`条件逻辑处理测试特有情况
   - 清晰注释所有特殊的环境适配代码
   - 尽量使测试环境处理集中在少数几个地方

## 其他注意事项

- 业务代码应该遵循代码库中的风格和约定
- 避免在业务代码中添加特定于测试的逻辑，除非这是唯一选择
- 保持代码简洁且易于理解
- 每次测试运行了以后要总结一下这次测试的进展以及剩下的问题
- 考虑通用性设计，避免只针对特定测试用例的硬编码解决方案
